async function saveData() {
    const btn = document.getElementById('btn');
    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const telegram = document.getElementById('telegram').value.trim().replace('@','');

    const params = new URLSearchParams(window.location.search);
    const cardId = params.get('id');

    alert("Aloqa boshlandi. ID: " + cardId); // 1-qadam tekshiruvi

    if (!name || !phone) {
        alert("Ism va telefonni kiriting!");
        return;
    }

    btn.disabled = true;
    btn.innerText = "Yuborilmoqda...";

    const img = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=random&size=200&bold=true`;

    try {
        console.log("Ma'lumotlar:", { id: cardId, qr_code: cardId, name, phone, telegram, image_url: img });

        // Eng muhim nuqta:
        const { data, error } = await supabase
            .from('users')
            .insert([{ 
                id: cardId, 
                qr_code: cardId, 
                name: name, 
                phone: phone, 
                telegram: telegram, 
                image_url: img 
            }])
            .select(); // Bu joyi ma'lumot qaytishini ta'minlaydi

        if (error) {
            console.error("Supabase xatosi:", error);
            alert("BAZA XATOSI: " + error.message + "\nKod: " + error.code);
            btn.disabled = false;
            btn.innerText = "QAYTA URINISH";
        } else {
            alert("Muvaffaqiyatli saqlandi! Profilga o'tamiz...");
            window.location.href = `profile.html?id=${cardId}`;
        }
    } catch (err) {
        alert("KODDA XATO: " + err.message);
        console.error(err);
        btn.disabled = false;
    }
}